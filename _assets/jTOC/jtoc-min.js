(function($){"use strict";var jTOC=function(dom,options){var self=this,defaultOpts;defaultOpts={content:"body",headings:"h1,h2,h3",anchorPrefix:'',scrollEnabled:true,scrollSpeed:400,scrollEase:'swing',scrollEl:'body,html',scrollOffset:0};self.opts=$.extend(defaultOpts,options);self.init=function(){self.$dom=$(dom);self.stack=[self.$dom];self.listTag=dom.tagName;self.currentLevel=0;self.headingSelectors=self.opts.headings.split(',');self.parseContent();self.$dom.trigger('jTocBuilt');return self};self.parseContent=function(){$(self.opts.content).find(self.opts.headings).each(function(){var $el=$(this),anchorName,$a,level,parentItem;level=$.map(self.headingSelectors,function(selector,index){return $el.is(selector)?index:undefined})[0];anchorName=self.opts.anchorPrefix+$el.text().replace(/^[^A-Za-z]*/,"").replace(/[^A-Za-z0-9]+/g,"_");if($el.attr('id')!==anchorName){$('<span/>').attr('id',anchorName).insertBefore($el)}if(level>self.currentLevel){parentItem=self.stack[0].children("li:last")[0];if(parentItem){self.stack.unshift($("<"+self.listTag+"/>").appendTo(parentItem))}}else{self.stack.splice(0,Math.min(self.currentLevel-level,Math.max(self.stack.length-1,0)))}$a=$('<a/>').text($el.text()).attr('href','#'+anchorName).addClass('toc-link toc-link--level-'+level).bind('click',function(e){if(self.opts.scrollEnabled===true){e.preventDefault();self.scrollTo('#'+anchorName)}$el.trigger('selected',$(this).attr('href'));$(this).blur()});$("<li/>").appendTo(self.stack[0]).append($a);self.currentLevel=level});return self};self.scrollTo=function(selector){var $el=$(selector);$(self.opts.scrollEl).animate({scrollTop:$el.offset().top-$(self.opts.scrollEl).offset().top-self.opts.scrollOffset},self.opts.scrollSpeed,self.opts.scrollEase,function(){var hash=$el.attr('id');if(hash.length){if(history.pushState){history.pushState(null,null,'#'+hash)}else{document.location.hash=hash}}$el.trigger('scrollComplete')});return self};self.init();return self};$.fn.jtoc=function(options){this.each(function(i,d){new jTOC(d,options)});return this}}(jQuery));
